<html>
	<head>
		<link rel="stylesheet" href="https://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
		<script type="text/javascript" src="https://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
		<script src="jquery.ui.touch-punch.min.js"></script>
      <meta name="viewport" content="width=device-width,initial-scale=1.0">
		<!-- CSS -->
		<style type="text/css">
		.square {
		    width: 80px;
		    height: 80px;
		    border: 1px solid black;
		    margin-bottom: 0px;
		    margin-left: 0px;
		    text-align: center;
		    float: left;
		    background-color: lightblue;
		    font-weight: bold;
		}

		.squaredotted {
		    width: 80px;
		    height: 80px;
		    line-height: 80px;
		    border: 1px dotted gray;
		    margin-bottom: 0px;
		    margin-left: 0px;
		    text-align: center;
		    float: left;
		    color: gray;
		    background-color: lightgray;
		}
      .blank {
          width: 30px;
		    height: 80px;
		    line-height: 80px;
		    border: 1px white;
		    margin-bottom: 50px;
		    margin-left: 5px;
		    text-align: center;
		    float: left;
		    color: white;
		    background-color: white;
		}
      .blank_small {
		    width: 20px;
		    height: 20px;
		    line-height: 80px;
		    border: 1px white;
		    margin-bottom: 20px;
		    margin-left: 49px;
		    text-align: center;
		    float: left;
		    color: white;
		    background-color: white;
		}
		</style>

		<!-- Javascript -->

      <script type="text/javascript">

         $( document ).ready(function() {
               var occupied = new Array(100).fill(0);;
            let detectTap = false;

            $('body').on('touchstart', '#sortableMenu input', () => {
            detectTap = true;
            });
            $('body').on('touchmove', '#sortableMenu input', () => {
            detectTap = false;
            });
            $('body').on('touchend', '#sortableMenu input', (e) => {
            if (detectTap) $(e.target).focus();
            });

         $(function () {
            $(".square").draggable({
               snap: ".squaredotted",
               snapMode: "inner",
               revert:function(event, ui) { 
                  
                  /* Get the possible snap targets: */
                  var snapped = $(this).data('ui-draggable').snapElements;

                  /* Pull out only the snap targets that are "snapping": */
                  var snappedTo = $.map(snapped, function(element) {
                     return element.snapping ? element.item : null;
                  });
                  var result = [];
                  $.each(snappedTo, function(idx, item) {
                     result.push($(item).text());
                  });
                  if(result.length == 1 && occupied[result[0]] == 1){
                     return true;
                  }
                  
               },
               stop: function(event, ui) { 
                  /* Get the possible snap targets: */
                  var snapped = $(this).data('ui-draggable').snapElements;

                  /* Pull out only the snap targets that are "snapping": */
                  var snappedTo = $.map(snapped, function(element) {
                     return element.snapping ? element.item : null;
                  });


                  /* Display the results: */
                  var result = [];
                  var pos;
                  $.each(snappedTo, function(idx, item) {
                     result.push($(item).text());
                     pos = $(item).offset();
                  });
                  console.log("current_number: " + $(this).data("current_number"));
                  if(result.length == 0){
                     if($(this).data("current_number") == "1" || $(this).data("current_number") == "3" || $(this).data("current_number") == "5" || $(this).data("current_number") == "7" || $(this).data("current_number") == "9" || $(this).data("current_number") == "11") {
                        document.getElementById("leftWeight").value = parseFloat(document.getElementById("leftWeight").value) - parseFloat($(this).find("input")[1].value);
                        console.log("1");
                     }
                     if($(this).data("current_number") == "2" || $(this).data("current_number") == "4" || $(this).data("current_number") == "6" || $(this).data("current_number") == "8" || $(this).data("current_number") == "10" || $(this).data("current_number") == "12") {
                        document.getElementById("rightWeight").value = parseFloat(document.getElementById("rightWeight").value) - parseFloat($(this).find("input")[1].value);
                        console.log("2");
                     }
                     $(this).css("background-color", "lightblue");
                     occupied[parseInt($(this).data("current_number"))] = 0;
                     $(this).data("current_number", 0);
                  }else if (result.length == 1) {
                     if($(this).data("current_number") == undefined || $(this).data("current_number") == 0) {
                        if(result[0] == "1" || result[0] == "3" || result[0] == "5" || result[0] == "7" || result[0] == "9" || result[0] == "11") {
                           console.log("3");
                           if(occupied[result[0]] == 0){
                              occupied[result[0]] = 1;
                              $(this).css("background-color", "lightyellow");
                              console.log("occupied[" + occupied[result[0]] + "] = " + occupied[result[0]]);
                              document.getElementById("leftWeight").value = parseFloat(document.getElementById("leftWeight").value) + parseFloat($(this).find("input")[1].value);
                              $(this).data("current_number", result[0]);
                              $(this).offset({'top' : pos.top});
                              $(this).offset({'left' : pos.left});
                              console.log(pos)
                           }
                        }
                        if(result[0] == "2" || result[0] == "4" || result[0] == "6" || result[0] == "8" || result[0] == "10" || result[0] == "12") {
                           console.log("4");
                           if(occupied[result[0]] == 0){
                              $(this).css("background-color", "lightyellow");
                              document.getElementById("rightWeight").value = parseFloat(document.getElementById("rightWeight").value) + parseFloat($(this).find("input")[1].value);
                              occupied[result[0]] = 1;
                              $(this).data("current_number", result[0]);
                              $(this).offset({'top' : pos.top});
                              $(this).offset({'left' : pos.left});
                           }
                        }
                     }else if((result[0] == "2" || result[0] == "4" || result[0] == "6" || result[0] == "8" || result[0] == "10" || result[0] == "12") && ($(this).data("current_number") == "1" || $(this).data("current_number") == "3" || $(this).data("current_number") == "5" || $(this).data("current_number") == "7" || $(this).data("current_number") == "9" || $(this).data("current_number") == "11")){
                        console.log("5");
                        if(occupied[result[0]] == 0){
                           $(this).css("background-color", "lightyellow");
                           occupied[parseInt($(this).data("current_number"))] = 0;
                           occupied[result[0]] = 1;
                           document.getElementById("leftWeight").value = parseFloat(document.getElementById("leftWeight").value) - parseFloat($(this).find("input")[1].value);
                           document.getElementById("rightWeight").value = parseFloat(document.getElementById("rightWeight").value) + parseFloat($(this).find("input")[1].value);
                           $(this).data("current_number", result[0]);
                           $(this).offset({'top' : pos.top});
                           $(this).offset({'left' : pos.left});
                        }
                     }else if((result[0] == "1" || result[0] == "3" || result[0] == "5" || result[0] == "7" || result[0] == "9" || result[0] == "11") && ($(this).data("current_number") == "2" || $(this).data("current_number") == "4" || $(this).data("current_number") == "6" || $(this).data("current_number") == "8" || $(this).data("current_number") == "10" || $(this).data("current_number") == "12")){
                        console.log("6");
                        if(occupied[result[0]] == 0){
                           $(this).css("background-color", "lightyellow");
                           document.getElementById("rightWeight").value = parseFloat(document.getElementById("rightWeight").value) - parseFloat($(this).find("input")[1].value);
                           document.getElementById("leftWeight").value = parseFloat(document.getElementById("leftWeight").value) + parseFloat($(this).find("input")[1].value);
                           occupied[result[0]] = 1;
                           occupied[parseInt($(this).data("current_number"))] = 0;
                           $(this).data("current_number", result[0]);
                           $(this).offset({'top' : pos.top});
                           $(this).offset({'left' : pos.left});
                        }
                     }else if((result[0] == "1" || result[0] == "3" || result[0] == "5" || result[0] == "7" || result[0] == "9" || result[0] == "11") && ($(this).data("current_number") == "1" || $(this).data("current_number") == "3" || $(this).data("current_number") == "5" || $(this).data("current_number") == "7" || $(this).data("current_number") == "9" || $(this).data("current_number") == "11")){
                        console.log("7");
                        if(occupied[result[0]] == 0){
                           $(this).css("background-color", "lightyellow");
                           occupied[result[0]] = 1;
                           occupied[parseInt($(this).data("current_number"))] = 0;
                           $(this).data("current_number", result[0]);
                           $(this).offset({'top' : pos.top});
                           $(this).offset({'left' : pos.left});
                        }
                     }else if((result[0] == "2" || result[0] == "4" || result[0] == "6" || result[0] == "8" || result[0] == "10" || result[0] == "12") && ($(this).data("current_number") == "2" || $(this).data("current_number") == "4" || $(this).data("current_number") == "6" || $(this).data("current_number") == "8" || $(this).data("current_number") == "10" || $(this).data("current_number") == "12")){
                        console.log("8");
                        if(occupied[result[0]] == 0){
                           $(this).css("background-color", "lightyellow");
                           occupied[parseInt($(this).data("current_number"))] = 0;
                           occupied[result[0]] = 1;
                           $(this).data("current_number", result[0]);
                           $(this).offset({'top' : pos.top});
                           $(this).offset({'left' : pos.left});
                        }
                     }
                  }
                  console.log("result:" + result)
               }
            });
         });
            $("input[id='weight_input']").on('focusin', function(){
               $(this).data('val', $(this).val());
            });

            $("input[id='weight_input']").change(function() {
               var prev = $(this).data('val');
               var current = $(this).val();
               console.log("Prev value " + prev);
               console.log("New value " + current);
               console.log("current_number: " + $(this).parent("div").data("current_number"));
               console.log($(this).parent("div"));
               if($(this).parent("div").data("current_number") == "1" || $(this).parent("div").data("current_number") == "3" || $(this).parent("div").data("current_number") == "5" || $(this).parent("div").data("current_number") == "7" || $(this).parent("div").data("current_number") == "9" || $(this).parent("div").data("current_number") == "11") {
                  document.getElementById("leftWeight").value = parseFloat(document.getElementById("leftWeight").value) + parseFloat(current) - parseFloat(prev);
               }
               if($(this).parent("div").data("current_number") == "2" || $(this).parent("div").data("current_number") == "4" || $(this).parent("div").data("current_number") == "6" || $(this).parent("div").data("current_number") == "8" || $(this).parent("div").data("current_number") == "10" || $(this).parent("div").data("current_number") == "12") {
                  document.getElementById("rightWeight").value = parseFloat(document.getElementById("leftWeight").value) + parseFloat(current) - parseFloat(prev);
               }
            });
         });
      </script>
	</head>
	<body>
		<div class="spaces" style="float:left;margin-left:50px;">
         <div class="blank_small"></div>
         <input id="leftWeight" readonly="readonly" style="margin-left: 50px; width: 80px" value=0></input>
         <input id="rightWeight" readonly="readonly" style="margin-left: 148px; width: 80px" value=0></input>
         
         <div style="clear:both"></div>
         <div class="square">
		      <input style="width: 70px; margin-top: 5px;" value="郭佬"></input>
		      <input style="width: 70px; margin-top: 5px;" type="tel" id="weight_input"value="80"></input>
		    </div>
          <div class="blank"></div>
		    <div class="squaredotted">1</div>
          <div class="blank"></div>
          <div class="square">
		      <input style="width: 70px; margin-top: 5px;" value="郭佬"></input>
		      <input style="width: 70px; margin-top: 5px;" type="tel" id="weight_input"value="80"></input>
		    </div>
          <div class="blank"></div>
		    <div class="squaredotted">2</div>
          <div class="blank"></div>
          <div class="square">
		      <input style="width: 70px; margin-top: 5px;" value="郭佬"></input>
		      <input style="width: 70px; margin-top: 5px;" type="tel" id="weight_input"value="80"></input>
		    </div>
		    <div style="clear:both"></div>
          <div class="square">
		      <input style="width: 70px; margin-top: 5px;" value="郭佬"></input>
		      <input style="width: 70px; margin-top: 5px;" type="tel" id="weight_input"value="80"></input>
		    </div>
          <div class="blank"></div>
		    <div class="squaredotted">3</div>
          <div class="blank"></div>
          <div class="square">
		      <input style="width: 70px; margin-top: 5px;" value="郭佬"></input>
		      <input style="width: 70px; margin-top: 5px;" type="tel" id="weight_input"value="80"></input>
		    </div>
          <div class="blank"></div>
		    <div class="squaredotted">4</div>
          <div class="blank"></div>
          <div class="square">
		      <input style="width: 70px; margin-top: 5px;" value="郭佬"></input>
		      <input style="width: 70px; margin-top: 5px;" type="tel" id="weight_input"value="80"></input>
		    </div>
		    <div style="clear:both"></div>
          <div class="square">
		      <input style="width: 70px; margin-top: 5px;" value="郭佬"></input>
		      <input style="width: 70px; margin-top: 5px;" type="tel" id="weight_input"value="80"></input>
		    </div>
          <div class="blank"></div>
		    <div class="squaredotted">5</div>
          <div class="blank"></div>
          <div class="square">
		      <input style="width: 70px; margin-top: 5px;" value="郭佬"></input>
		      <input style="width: 70px; margin-top: 5px;" type="tel" id="weight_input"value="80"></input>
		    </div>
          <div class="blank"></div>
		    <div class="squaredotted">6</div>
          <div class="blank"></div>
          <div class="square">
		      <input style="width: 70px; margin-top: 5px;" value="郭佬"></input>
		      <input style="width: 70px; margin-top: 5px;" type="tel" id="weight_input"value="80"></input>
		    </div>
		    <div style="clear:both"></div>
          <div class="square">
		      <input style="width: 70px; margin-top: 5px;" value="郭佬"></input>
		      <input style="width: 70px; margin-top: 5px;" type="tel" id="weight_input"value="80"></input>
		    </div>
          <div class="blank"></div>
		    <div class="squaredotted">7</div>
          <div class="blank"></div>
          <div class="square">
		      <input style="width: 70px; margin-top: 5px;" value="郭佬"></input>
		      <input style="width: 70px; margin-top: 5px;" type="tel" id="weight_input"value="80"></input>
		    </div>
          <div class="blank"></div>
		    <div class="squaredotted">8</div>
          <div class="blank"></div>
          <div class="square">
		      <input style="width: 70px; margin-top: 5px;" value="郭佬"></input>
		      <input style="width: 70px; margin-top: 5px;" type="tel" id="weight_input"value="80"></input>
		    </div>
		    <div style="clear:both"></div>
          <div class="square">
		      <input style="width: 70px; margin-top: 5px;" value="郭佬"></input>
		      <input style="width: 70px; margin-top: 5px;" type="tel" id="weight_input"value="80"></input>
		    </div>
          <div class="blank"></div>
		    <div class="squaredotted">9</div>
          <div class="blank"></div>
          <div class="square">
		      <input style="width: 70px; margin-top: 5px;" value="郭佬"></input>
		      <input style="width: 70px; margin-top: 5px;" type="tel" id="weight_input"value="80"></input>
		    </div>
          <div class="blank"></div>
		    <div class="squaredotted">10</div>
          <div class="blank"></div>
          <div class="square">
		      <input style="width: 70px; margin-top: 5px;" value="郭佬"></input>
		      <input style="width: 70px; margin-top: 5px;" type="tel" id="weight_input"value="80"></input>
		    </div>
		    <div style="clear:both"></div>
          <div class="square">
		      <input style="width: 70px; margin-top: 5px;" value="郭佬"></input>
		      <input style="width: 70px; margin-top: 5px;" type="tel" id="weight_input"value="80"></input>
		    </div>
          <div class="blank"></div>
		    <div class="squaredotted">11</div>
          <div class="blank"></div>
          <div class="square">
		      <input style="width: 70px; margin-top: 5px;" value="郭佬"></input>
		      <input style="width: 70px; margin-top: 5px;" type="tel" id="weight_input"value="80"></input>
		    </div>
          <div class="blank"></div>
		    <div class="squaredotted">12</div>
          <div class="blank"></div>
          <div class="square">
		      <input style="width: 70px; margin-top: 5px;" value="郭佬"></input>
		      <input style="width: 70px; margin-top: 5px;" type="tel" id="weight_input"value="80"></input>
		    </div>
         </div>
	</body>
</html>
